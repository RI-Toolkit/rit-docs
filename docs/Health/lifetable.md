# Life Table Generation

An individual's characteristics can also be used to generate a life table with a cohort of identical
traits. This can be used to calculate the probability of survival to different states.

Life tables generated from the static and trend models are always deterministic, so the output will be one lifetable.

Meanwhile, the frailty model will produce stochastic outputs. The lifetables outputted will be 
a full list of the simulated lifetables. 

The lifetable shows the number of people in each state at each age, and one can also choose
the initial state and the initial age that the starting cohort is in.

--- 

### Generating a Life Table for Static and Trend Models

**create_life_table(trans_probs, init_age, init_state = 0, cohort = 100000)**

&nbsp;&nbsp; **Parameters:**

&nbsp;&nbsp;&nbsp;&nbsp; trans_probs : list

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *list of transition probability matrices; typically generated by 'get_trans_probs'*

&nbsp;&nbsp;&nbsp;&nbsp; init_age : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *numeric denoting initial age of individual*

&nbsp;&nbsp;&nbsp;&nbsp; init_state : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *for 3-state model: integer value of 0 or 1, where 0 for healthy state, 1 for disabled state* 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *for 5-state model: 0 for H state, 1 for M state, 2 for D state, 3 for MD state* 

&nbsp;&nbsp;&nbsp;&nbsp; cohort : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *number of people at the beginning of the life table*

&nbsp;&nbsp; **Returns:**

&nbsp;&nbsp;&nbsp;&nbsp; A life table matrix

&nbsp;&nbsp; **Usage:**
```r
# for male aged 65 at wave index i, initially in the health state, using the static model with parameters 'params'
trans_probs <- get_trans_probs(n_states=5, model_type='S', param_file=US_HRS_5, init_age=65, female=0, year = 2012, wave_index = 8, latent = 0)
lifetable <- create_life_table(trans_probs, init_age=65, init_state = 0, cohort = 100000)
```
--- 

### Simulating a Number of Life Tables for Frailty Model

**simulate_life_table(n_states, model_type, param_file, init_age, female, year = 2012, init_state = 0, wave_index = 8,latent=0,n_sim=100,cohort=100000,mean=FALSE)**

&nbsp;&nbsp; **Parameters:**

&nbsp;&nbsp;&nbsp;&nbsp; n_states : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *take values 3 or 5, use 3 for 3-state model, and 5 for 5-state model*

&nbsp;&nbsp;&nbsp;&nbsp; model_type : character

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *select F for Frailty model*

&nbsp;&nbsp;&nbsp;&nbsp; param_file : dataframe

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *File path, or dataframe/tibble of parameters (generally, use US_HRS or china_CLHLS for the 3-state model, and use US_HRS_5 for the 5-state-model)*

&nbsp;&nbsp;&nbsp;&nbsp; init_age : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *integer denoting the initial age*

&nbsp;&nbsp;&nbsp;&nbsp; female : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *0 for male, 1 for female*

&nbsp;&nbsp;&nbsp;&nbsp; year : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *integer denoting current year, required in 3-state model and ignored in 5-state model*

&nbsp;&nbsp;&nbsp;&nbsp; init_state : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *for 3-state model: integer value of 0 or 1, where 0 for healthy state, 1 for disabled state* 

&nbsp;&nbsp;&nbsp;&nbsp; wave_index : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *integer for the wave index = (interview year - 1998)/2 + 1, required in 5-state model and ignored in 3-state model*

&nbsp;&nbsp;&nbsp;&nbsp; latent : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *initial value of latent factor, normally take the value 0*

&nbsp;&nbsp;&nbsp;&nbsp; n_sim : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *integer denoting number of life table simulations*

&nbsp;&nbsp;&nbsp;&nbsp; cohort : numeric

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *number of people at the beginning of the life table*

&nbsp;&nbsp;&nbsp;&nbsp; mean : logic

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *TRUE to return expected life table, FALSE to return all simulated life tables*

&nbsp;&nbsp; **Returns:**

&nbsp;&nbsp;&nbsp;&nbsp; A list of life table matrices if mean = FALSE, or a life table matrix if mean = TRUE

&nbsp;&nbsp; **Usage:**

```r
# for male aged 65 at wave index i, initially in the health state, using the frailty model with parameters 'params'
lifetable_simulated <- simulate_life_table(n_states=5, model_type='F', param_file=US_HRS_5, init_age=65, female=0, year = 2012, init_state = 0, wave_index = 8,latent=0,n_sim=100,cohort=100000,mean=FALSE)
```